#!/bin/bash

# Скрипт для мониторинга состояния системы
# Использование: ./system_monitor.sh [интервал_в_секундах]

INTERVAL=${1:-5} # Интервал по умолчанию 5 секунд

echo "Мониторинг системы (обновление каждые $INTERVAL секунд)"
echo "Нажмите Ctrl+C для выхода"

while true; do
    clear
    
    # Дата и время
    echo "===== $(date) ====="
    echo ""
    
    # Загрузка системы
    echo "### Загрузка системы ###"
    uptime
    echo ""
    
    # Использование CPU
    echo "### Использование CPU ###"
    top -bn1 | grep "Cpu(s)" | sed "s/.*, *\([0-9.]*\)%* id.*/\1/" | awk '{print "CPU загружен на " 100 - $1"%"}'
    echo ""
    
    # Использование памяти
    echo "### Использование памяти ###"
    free -h
    echo ""
    
    # Использование диска
    echo "### Использование дискового пространства ###"
    df -h
    echo ""
    
    # 5 процессов, потребляющих больше всего CPU
    echo "### Топ-5 процессов по использованию CPU ###"
    ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head -n 6
    echo ""
    
    # 5 процессов, потребляющих больше всего памяти
    echo "### Топ-5 процессов по использованию памяти ###"
    ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head -n 6
    echo ""
    
    sleep $INTERVAL
done
